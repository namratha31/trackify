{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <!-- Savings Rate Overview -->
    <div class="card mb-4">
        <div class="card-body text-center">
            <h2 class="card-title welcome-message mb-4">Your Financial Health</h2>
            <div class="savings-meter position-relative mb-4">
                <svg width="200" height="100" viewBox="0 0 200 100" class="mx-auto d-block">
                    <path d="M20,90 A80,80 0 0,1 180,90" stroke="#e2e8f0" stroke-width="20" fill="none"/>
                    <path d="M20,90 A80,80 0 0,1 180,90" 
                          stroke="url(#gradient)" 
                          stroke-width="20" 
                          fill="none" 
                          stroke-dasharray="251.2"
                          stroke-dashoffset="{{ 251.2 - (251.2 * savings_rate/100) if savings_rate <= 100 else 0 }}"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:var(--primary)"/>
                            <stop offset="100%" style="stop-color:var(--primary-dark)"/>
                        </linearGradient>
                    </defs>
                </svg>
                <div class="position-absolute top-50 start-50 translate-middle">
                    <h3 class="mb-0">{{ "%.1f"|format(savings_rate) }}%</h3>
                    <p class="text-muted mb-0">Savings Rate</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Tips -->
    <div class="row g-4">
        <!-- Tips Section -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>
                        Smart Tips
                    </h3>
                    <div class="tips-container">
                        {% for tip in tips %}
                        <div class="alert alert-{{ tip.type }} mb-3">
                            <h5 class="alert-heading">{{ tip.title }}</h5>
                            <p class="mb-0">{{ tip.description }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Savings Goals -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title">
                        <i class="fas fa-trophy me-2 text-primary"></i>
                        Savings Goals
                    </h3>
                    {% for goal in savings_goals %}
                    <div class="goal-card mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="mb-0">{{ goal.title }}</h5>
                            <span class="badge bg-{{ 'danger' if goal.priority == 'High' 
                                                  else 'warning' if goal.priority == 'Medium'
                                                  else 'success' }}">
                                {{ goal.priority }}
                            </span>
                        </div>
                        <p class="text-muted mb-2">{{ goal.description }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">Target Amount</small>
                            <span class="fw-bold">${{ "%.2f"|format(goal.target) }}</span>
                        </div>
                    </div>
                    {% endfor %}

                    {% if user_goals %}
                    <hr>
                    <h5 class="mt-3">Your Personal Goals</h5>
                    {% for goal in user_goals %}
                    <div class="goal-card mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="mb-0">{{ goal.name }}</h5>
                            {% if goal.deadline %}
                            <span class="badge bg-info">{{ goal.deadline.strftime('%Y-%m-%d') }}</span>
                            {% endif %}
                        </div>
                        {% if goal.description %}
                        <p class="text-muted mb-2">{{ goal.description }}</p>
                        {% endif %}
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">Target Amount</small>
                            <span class="fw-bold">${{ "%.2f"|format(goal.target_amount) }}</span>
                        </div>
                        <div class="progress mt-2" style="height: 18px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ (goal.progress/goal.target_amount*100)|round(1) if goal.target_amount else 0 }}%;" aria-valuenow="{{ goal.progress }}" aria-valuemin="0" aria-valuemax="{{ goal.target_amount }}">
                                ${{ goal.progress }} / ${{ goal.target_amount }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Savings Challenges -->
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">
                        <i class="fas fa-flag me-2 text-success"></i>
                        Money-Saving Challenges
                    </h3>
                    <div class="row g-4">
                        {% for challenge in challenges %}
                        <div class="col-md-4">
                            <div class="challenge-card h-100 p-4 rounded-3 border">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="mb-0">{{ challenge.title }}</h5>
                                    <span class="badge bg-{{ 'success' if challenge.difficulty == 'Easy'
                                                       else 'warning' if challenge.difficulty == 'Medium'
                                                       else 'danger' }}">
                                        {{ challenge.difficulty }}
                                    </span>
                                </div>
                                <p class="mb-3">{{ challenge.description }}</p>
                                <button class="btn btn-outline-primary btn-sm">Start Challenge</button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Additional Styles -->
<style>
.savings-meter {
    width: 200px;
    height: 100px;
    margin: 0 auto;
}

.goal-card {
    padding: 1rem;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(99, 102, 241, 0.01) 100%);
    transition: all 0.3s ease;
}

.goal-card:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(99, 102, 241, 0.02) 100%);
}

.challenge-card {
    background: var(--card-bg);
    transition: all 0.3s ease;
    border: 2px solid var(--border-color) !important;
}

.challenge-card:hover {
    transform: translateY(-2px);
    border-color: var(--primary) !important;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
}

.tips-container {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 0.5rem;
}

.tips-container::-webkit-scrollbar {
    width: 4px;
}

.tips-container::-webkit-scrollbar-thumb {
    background-color: var(--primary);
    border-radius: 2px;
}

.alert {
    margin-bottom: 1rem;
    border-radius: 12px;
}

.alert-heading {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}
</style>
{% endblock %}